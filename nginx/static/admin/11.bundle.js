(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{331:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r(518);var n=m(r(512));r(87);var a=m(r(86));r(336);var l=m(r(335));r(122);var o=m(r(123));r(399);var i=m(r(360));r(125);var u=m(r(124)),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(1)),s=r(36),f=m(r(31)),d=m(r(466)),p=m(r(121));function m(e){return e&&e.__esModule?e:{default:e}}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var g=u.default.Item,w=i.default.Option,E=o.default.TextArea,C=function(e){function t(e,r){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=function(e,t){return!t||"object"!==h(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,y(t).call(this,e,r))).state={editorContent:"",screenshot:"/static/images/default.jpg",article:{},categories:[]},n}var r,s;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,c.Component),r=t,(s=[{key:"componentDidMount",value:function(){var e=this.props.match,t=this;e.params.id?p.default.all([p.default.get("/articles/"+e.params.id),p.default.get("/categories/")]).then(p.default.spread(function(e,r){t.setState({article:e.data,categories:r.data,editorContent:e.data.content,screenshot:e.data.screenshot})})):p.default.get("/categories/").then(function(e){t.setState({categories:e.data})})}},{key:"handleUpload",value:function(e){if(Array.isArray(e))return e;var t=e.fileList;return t=(t=t.slice(-1)).map(function(e){return e.response&&(e.url=e.response.url),e}),"done"===e.file.status?l.default.success("图片上传成功！"):"error"===e.file.status&&l.default.error("图片上传失败！"),t}},{key:"publish",value:function(e){var t=this;e.preventDefault();var r=this.props,n=r.match,a=r.history;this.props.form.validateFields(function(e,r){Object.assign(r,{screenshot:r.screenshot[0].url}),e||(n.params.id?t.updateArticle(n.params.id,r):t.createArticle(r)).then(function(){alert("提交成功"),a.push("/blog/admin/articles")})})}},{key:"createArticle",value:function(e){return p.default.post("/articles",e)}},{key:"updateArticle",value:function(e,t){return p.default.put("/articles/"+e,t)}},{key:"onChange",value:function(e){this.setState({editorContent:e})}},{key:"render",value:function(){var e=this,t=this.state,r=t.article,l=t.categories,s=this.props.form.getFieldDecorator,p=r.category||{},m=l&&l.map(function(e){return c.default.createElement(w,{key:e._id},e.name)}),h=[{uid:-1,status:"done",url:this.state.screenshot}];return c.default.createElement("div",{className:"main-content"},c.default.createElement("div",{className:"manager-tip"},c.default.createElement("i",{className:"fa fa-edit fa-fw"}),c.default.createElement("strong",null,"控制台----文章添加或编辑")),c.default.createElement(u.default,{onSubmit:function(t){return e.publish(t)},style:{marginTop:"20px"}},c.default.createElement(g,{labelCol:{span:3},wrapperCol:{span:10},label:"文章标题："},s("title",{rules:[{required:!0,message:"标题不能为空！"}],initialValue:r.title})(c.default.createElement(o.default,{type:"text"}))),c.default.createElement(g,{labelCol:{span:3},wrapperCol:{span:3},label:"文章分类："},s("category",{rules:[{required:!0,message:"分类不能为空!"}],initialValue:p._id})(c.default.createElement(i.default,{placeholder:"请选择一个分类"},m))),c.default.createElement(g,{labelCol:{span:3},wrapperCol:{span:3},label:"上传图片："},s("screenshot",{initialValue:h,valuePropName:"fileList",getValueFromEvent:this.handleUpload})(c.default.createElement(n.default,{disabled:!1,action:"/api/upload/image?w=200&h=200",onChange:this.handleChange,multiple:!1,name:"file",listType:"picture",headers:{authorization:localStorage.getItem(f.default.tokenKey)},onRemove:function(){return!1}},c.default.createElement(a.default,null,c.default.createElement("i",{className:"fa fa-arrow-up"}),"点击上传")))),c.default.createElement(g,{labelCol:{span:3},wrapperCol:{span:10},label:"文章摘要："},s("summary",{initialValue:r.summary})(c.default.createElement(E,{placeholder:"请输入文章摘要",autosize:{minRows:2,maxRows:6}}))),c.default.createElement(g,{label:"文章详情：",labelCol:{span:3},wrapperCol:{span:20}},s("content",{initialValue:r.content||""})(c.default.createElement(d.default,null))),c.default.createElement(g,{labelCol:{span:3},wrapperCol:{span:10},label:"操作："},c.default.createElement(a.default,{type:"primary",htmlType:"submit"},"发布"),c.default.createElement(a.default,null,"存为草稿"))))}}])&&v(r.prototype,s),t}(),k=(0,s.withRouter)(u.default.create()(C));t.default=k},407:function(e,t,r){},466:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(1)),a=o(r(465)),l=o(r(121));function o(e){return e&&e.__esModule?e:{default:e}}function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=r(350);r(410),r(407);var p=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=c(this,s(t).call(this,e))).markdown=new a.default,r.state={MarkdownContent:r.props.value||"",isPreview:!1},r}var r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,n.Component),r=t,(o=[{key:"getCodeMirror",value:function(){return this.codeMirror}},{key:"_replaceSelection",value:function(e,t){var r=e.getCursor("start"),n=e.getCursor("end");e.replaceSelection(t.before+e.getSelection()+t.after),r.ch+=t.before.length,n.ch+=t.after.length,e.setSelection(r,n),e.focus()}},{key:"insertLink",value:function(){var e=this.getCodeMirror();this._replaceSelection(e,{before:"[",after:"](http://)"})}},{key:"insertImage",value:function(){var e=this,t=document.createElement("input");t.setAttribute("name","file"),t.setAttribute("type","file"),t.setAttribute("style","visibility:hidden"),t.click(),t.onchange=function(){var r=new FormData;r.append("file",t.files[0]),(0,l.default)({url:"/upload/image",method:"post",data:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){var r=e.getCodeMirror(),n={before:"![",after:"]("+t.data.url+")"};e._replaceSelection(r,n)})}}},{key:"preview",value:function(){var e=this.markdown.render(this._currentCodemirrorValue);this.state.isPreview?this.setState({isPreview:!1}):this.setState({MarkdownContent:e,isPreview:!0})}},{key:"toggleFullScreen",value:function(){var e=this.getCodeMirror().getWrapperElement(),t=document,r=function(){t.cancelFullScreen?t.cancelFullScreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen&&t.webkitCancelFullScreen()};t.fullScreen||t.mozFullScreen||t.webkitFullScreen?r&&r():e.requestFullScreen?e.requestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}},{key:"codemirrorValueChanged",value:function(e,t){var r=e.getValue();this._currentCodemirrorValue=r,this.props.onChange&&this.props.onChange(r)}},{key:"getOptions",value:function(){return Object.assign({mode:"markdown",lineNumbers:!1,indentWithTabs:!0,tabSize:"4",dragDrop:!1,styleActiveLine:!1,lineWrapping:!0},this.props.options||{})}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.codeMirror&&this._currentCodemirrorValue!==e.value&&this.codeMirror.setValue(e.value)}},{key:"componentDidMount",value:function(){var e=this;this.codeMirror=d.fromTextArea(document.getElementById("codemirror"),this.getOptions()),this.codeMirror.on("change",function(t,r){return e.codemirrorValueChanged(t,r)}),this._currentCodemirrorValue=this.props.value||""}},{key:"componentWillUnmount",value:function(){this.codeMirror&&this.codeMirror.toTextArea()}},{key:"render",value:function(){var e=this;return n.default.createElement("div",{className:"MdEditor"},n.default.createElement("div",{className:"MdEditor-toolbar"},n.default.createElement("button",{type:"button",className:"MdEditor-button",onClick:function(){return e.insertLink()},title:"链接"},n.default.createElement("svg",{className:"MdEditor-svg link",fill:"currentColor",viewBox:"0 0 24 24",width:"24",height:"24"},n.default.createElement("path",{d:"M6.77 17.23c-.905-.904-.94-2.333-.08-3.193l3.059-3.06-1.192-1.19-3.059 3.058c-1.489 1.489-1.427 3.954.138 5.519s4.03 1.627 5.519.138l3.059-3.059-1.192-1.192-3.059 3.06c-.86.86-2.289.824-3.193-.08zm3.016-8.673l1.192 1.192 3.059-3.06c.86-.86 2.289-.824 3.193.08.905.905.94 2.334.08 3.194l-3.059 3.06 1.192 1.19 3.059-3.058c1.489-1.489 1.427-3.954-.138-5.519s-4.03-1.627-5.519-.138L9.786 8.557zm-1.023 6.68c.33.33.863.343 1.177.029l5.34-5.34c.314-.314.3-.846-.03-1.176-.33-.33-.862-.344-1.176-.03l-5.34 5.34c-.314.314-.3.846.03 1.177z"}))),n.default.createElement("button",{type:"button",className:"MdEditor-button image",onClick:function(){return e.insertImage()},title:"上传图片"},n.default.createElement("svg",{className:"MdEditor-svg",fill:"currentColor",viewBox:"0 0 24 24",width:"24",height:"24"},n.default.createElement("path",{d:"M21 17.444C21 18.3 20.1 19 19 19H5c-1.1 0-2-.7-2-1.556V6.556C3 5.7 3.9 5 5 5h14c1.1 0 2 .7 2 1.556v10.888zm-9.437-3.919a.5.5 0 0 1-.862.013l-1.26-2.065a.5.5 0 0 0-.861.012l-2.153 3.767a.5.5 0 0 0 .435.748h10.292a.5.5 0 0 0 .438-.741L14.573 9.78a.5.5 0 0 0-.872-.006l-2.138 3.75z"}))),n.default.createElement("button",{type:"button",className:"MdEditor-button eye",onClick:function(){return e.preview()},title:"预览"},n.default.createElement("svg",{className:"MdEditor-svg",viewBox:"0 0 512 512",width:"30",height:"20"},n.default.createElement("path",{d:"M569.354 231.631C512.969 135.949 407.81 72 288 72 168.14 72 63.004 135.994 6.646 231.631a47.999 47.999 0 0 0 0 48.739C63.031 376.051 168.19 440 288 440c119.86 0 224.996-63.994 281.354-159.631a47.997 47.997 0 0 0 0-48.738zM288 392c-75.162 0-136-60.827-136-136 0-75.162 60.826-136 136-136 75.162 0 136 60.826 136 136 0 75.162-60.826 136-136 136zm104-136c0 57.438-46.562 104-104 104s-104-46.562-104-104c0-17.708 4.431-34.379 12.236-48.973l-.001.032c0 23.651 19.173 42.823 42.824 42.823s42.824-19.173 42.824-42.823c0-23.651-19.173-42.824-42.824-42.824l-.032.001C253.621 156.431 270.292 152 288 152c57.438 0 104 46.562 104 104z"}))),n.default.createElement("div",{style:{flex:"1 0 auto",textAlign:"center"}},n.default.createElement("strong",null,"markdown编辑器，开始写作吧！")),n.default.createElement("button",{type:"button",className:"MdEditor-button help",title:"帮助"},n.default.createElement("svg",{className:"MdEditor-svg",viewBox:"0 0 512 512",width:"20",height:"20"},n.default.createElement("path",{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}))),n.default.createElement("button",{type:"button",className:"MdEditor-button fullscreen",onClick:function(){return e.toggleFullScreen()},title:"全屏"},n.default.createElement("svg",{className:"MdEditor-svg",viewBox:"0 0 512 512",width:"20",height:"20"},n.default.createElement("path",{d:"M352.201 425.775l-79.196 79.196c-9.373 9.373-24.568 9.373-33.941 0l-79.196-79.196c-15.119-15.119-4.411-40.971 16.971-40.97h51.162L228 284H127.196v51.162c0 21.382-25.851 32.09-40.971 16.971L7.029 272.937c-9.373-9.373-9.373-24.569 0-33.941L86.225 159.8c15.119-15.119 40.971-4.411 40.971 16.971V228H228V127.196h-51.23c-21.382 0-32.09-25.851-16.971-40.971l79.196-79.196c9.373-9.373 24.568-9.373 33.941 0l79.196 79.196c15.119 15.119 4.411 40.971-16.971 40.971h-51.162V228h100.804v-51.162c0-21.382 25.851-32.09 40.97-16.971l79.196 79.196c9.373 9.373 9.373 24.569 0 33.941L425.773 352.2c-15.119 15.119-40.971 4.411-40.97-16.971V284H284v100.804h51.23c21.382 0 32.09 25.851 16.971 40.971z"})))),n.default.createElement("div",{className:"MdEditor-wraper"},n.default.createElement("textarea",{id:"codemirror",name:this.props.name,defaultValue:this.props.value}),this.state.isPreview&&n.default.createElement("div",{className:"preview markdown-body",dangerouslySetInnerHTML:{__html:this.state.MarkdownContent}})))}}])&&u(r.prototype,o),t}();t.default=p}}]);