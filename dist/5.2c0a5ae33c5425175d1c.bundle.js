(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{533:function(e,t,a){"use strict";a.r(t);a(484);var s=a(483),c=(a(32),a(8)),o=(a(43),a(20)),u=(a(52),a(28)),p=(a(202),a(84)),f=(a(69),a(18)),l=a(0),m=a.n(l),n=a(470),h=a(37),d=a(179),i=a(10);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t){return!t||"object"!==r(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=f.a.Item,E=p.a.Option,C=u.a.TextArea,O=function(e){function n(e,t){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(a=b(this,g(n).call(this,e,t))).state={editorContent:"",screenshot:"/static/images/default.jpg",article:{},categories:[]},a}var t,a,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(n,l["Component"]),t=n,(a=[{key:"componentDidMount",value:function(){var e=this.props.match,a=this;e.params.id?i.a.all([i.a.get("/articles/"+e.params.id),i.a.get("/categories/")]).then(i.a.spread(function(e,t){a.setState({article:e.data,categories:t.data,editorContent:e.data.content,screenshot:e.data.screenshot})})):i.a.get("/categories/").then(function(e){a.setState({categories:e.data})})}},{key:"handleUpload",value:function(e){if(Array.isArray(e))return e;var t=e.fileList;return t=(t=t.slice(-1)).map(function(e){return e.response&&(e.url=e.response.url),e}),"done"===e.file.status?o.a.success("图片上传成功！"):"error"===e.file.status&&o.a.error("图片上传失败！"),t}},{key:"publish",value:function(e){var a=this;e.preventDefault();var t=this.props,n=t.match,r=t.history;this.props.form.validateFields(function(e,t){(Object.assign(t,{screenshot:t.screenshot[0].url}),e)||(n.params.id?a.updateArticle(n.params.id,t):a.createArticle(t)).then(function(){alert("提交成功"),r.push("/blog/admin/articles")})})}},{key:"createArticle",value:function(e){return i.a.post("/articles",e)}},{key:"updateArticle",value:function(e,t){return i.a.put("/articles/"+e,t)}},{key:"onChange",value:function(e){this.setState({editorContent:e})}},{key:"render",value:function(){var t=this,e=this.state,a=e.article,n=e.categories,r=this.props.form.getFieldDecorator,o=a.category||{},l=n&&n.map(function(e){return m.a.createElement(E,{key:e._id},e.name)}),i=[{uid:-1,status:"done",url:this.state.screenshot}];return m.a.createElement("div",{className:"main-content"},m.a.createElement("div",{className:"manager-tip"},m.a.createElement("i",{className:"fa fa-edit fa-fw"}),m.a.createElement("strong",null,"控制台----文章添加或编辑")),m.a.createElement(f.a,{onSubmit:function(e){return t.publish(e)},style:{marginTop:"20px"}},m.a.createElement(w,{labelCol:{span:3},wrapperCol:{span:10},label:"文章标题："},r("title",{rules:[{required:!0,message:"标题不能为空！"}],initialValue:a.title})(m.a.createElement(u.a,{type:"text"}))),m.a.createElement(w,{labelCol:{span:3},wrapperCol:{span:3},label:"文章分类："},r("category",{rules:[{required:!0,message:"分类不能为空!"}],initialValue:o._id})(m.a.createElement(p.a,{placeholder:"请选择一个分类"},l))),m.a.createElement(w,{labelCol:{span:3},wrapperCol:{span:3},label:"上传图片："},r("screenshot",{initialValue:i,valuePropName:"fileList",getValueFromEvent:this.handleUpload})(m.a.createElement(s.a,{disabled:!1,action:"/api/upload/image?w=600&h=600",onChange:this.handleChange,multiple:!1,name:"file",listType:"picture",headers:{authorization:localStorage.getItem(h.a.tokenKey)},onRemove:function(){return!1}},m.a.createElement(c.a,null,m.a.createElement("i",{className:"fa fa-arrow-up"}),"点击上传")))),m.a.createElement(w,{labelCol:{span:3},wrapperCol:{span:10},label:"文章摘要："},r("summary",{initialValue:a.summary})(m.a.createElement(C,{placeholder:"请输入文章摘要",autosize:{minRows:2,maxRows:6}}))),m.a.createElement(w,{label:"文章详情：",labelCol:{span:3},wrapperCol:{span:20}},r("content",{initialValue:a.content||""})(m.a.createElement(d.a,null))),m.a.createElement(w,{labelCol:{span:3},wrapperCol:{span:10},label:"操作："},m.a.createElement(c.a,{type:"primary",htmlType:"submit"},"发布"),m.a.createElement(c.a,null,"存为草稿"))))}}])&&y(t.prototype,a),r&&y(t,r),n}();t.default=Object(n.a)(f.a.create()(O))}}]);