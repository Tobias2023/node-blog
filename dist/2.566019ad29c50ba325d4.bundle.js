(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{511:function(e,t,a){"use strict";a.r(t);a(214);var n=a(197),r=(a(30),a(10)),o=(a(34),a(15)),l=(a(45),a(28)),i=(a(213),a(78)),s=(a(62),a(18)),c=a(0),u=a.n(c),p=a(510),f=a(35),m=a(179),h=a(11);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var w=s.a.Item,E=i.a.Option,C=l.a.TextArea,O=function(e){function t(e,a){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=b(this,g(t).call(this,e,a))).state={editorContent:"",screenshot:"/static/images/default.jpg",article:{},categories:[]},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(t,c["Component"]),function(e,t,a){t&&y(e.prototype,t),a&&y(e,a)}(t,[{key:"componentDidMount",value:function(){var e=this.props.match,t=this;e.params.id?h.a.all([h.a.get("/articles/"+e.params.id),h.a.get("/categories/")]).then(h.a.spread(function(e,a){t.setState({article:e.data,categories:a.data,editorContent:e.data.content,screenshot:e.data.screenshot})})):h.a.get("/categories/").then(function(e){t.setState({categories:e.data})})}},{key:"handleUpload",value:function(e){if(Array.isArray(e))return e;var t=e.fileList;return t=(t=t.slice(-1)).map(function(e){return e.response&&(e.url=e.response.url),e}),"done"===e.file.status?o.a.success("图片上传成功！"):"error"===e.file.status&&o.a.error("图片上传失败！"),t}},{key:"publish",value:function(e){var t=this;e.preventDefault();var a=this.props,n=a.match,r=a.history;this.props.form.validateFields(function(e,a){(Object.assign(a,{screenshot:a.screenshot[0].url}),e)||(n.params.id?t.updateArticle(n.params.id,a):t.createArticle(a)).then(function(){alert("提交成功"),r.push("/blog/admin/articles")})})}},{key:"createArticle",value:function(e){return h.a.post("/articles",e)}},{key:"updateArticle",value:function(e,t){return h.a.put("/articles/"+e,t)}},{key:"onChange",value:function(e){this.setState({editorContent:e})}},{key:"render",value:function(){var e=this,t=this.state,a=t.article,o=t.categories,c=this.props.form.getFieldDecorator,p=a.category||{},h=o&&o.map(function(e){return u.a.createElement(E,{key:e._id},e.name)}),d=[{uid:-1,status:"done",url:this.state.screenshot}];return u.a.createElement("div",{className:"main-content"},u.a.createElement("div",{className:"manager-tip"},u.a.createElement("i",{className:"fa fa-edit fa-fw"}),u.a.createElement("strong",null,"控制台----文章添加或编辑")),u.a.createElement(s.a,{onSubmit:function(t){return e.publish(t)},style:{marginTop:"20px"}},u.a.createElement(w,{labelCol:{span:3},wrapperCol:{span:10},label:"文章标题："},c("title",{rules:[{required:!0,message:"标题不能为空！"}],initialValue:a.title})(u.a.createElement(l.a,{type:"text"}))),u.a.createElement(w,{labelCol:{span:3},wrapperCol:{span:3},label:"文章分类："},c("category",{rules:[{required:!0,message:"分类不能为空!"}],initialValue:p._id})(u.a.createElement(i.a,{placeholder:"请选择一个分类"},h))),u.a.createElement(w,{labelCol:{span:3},wrapperCol:{span:3},label:"上传图片："},c("screenshot",{initialValue:d,valuePropName:"fileList",getValueFromEvent:this.handleUpload})(u.a.createElement(n.a,{disabled:!1,action:"/api/upload/image?w=600&h=600",onChange:this.handleChange,multiple:!1,name:"file",listType:"picture",headers:{authorization:localStorage.getItem(f.a.tokenKey)},onRemove:function(){return!1}},u.a.createElement(r.a,null,u.a.createElement("i",{className:"fa fa-arrow-up"}),"点击上传")))),u.a.createElement(w,{labelCol:{span:3},wrapperCol:{span:10},label:"文章摘要："},c("summary",{initialValue:a.summary})(u.a.createElement(C,{placeholder:"请输入文章摘要",autosize:{minRows:2,maxRows:6}}))),u.a.createElement(w,{label:"文章详情：",labelCol:{span:3},wrapperCol:{span:20}},c("content",{initialValue:a.content||""})(u.a.createElement(m.a,null))),u.a.createElement(w,{labelCol:{span:3},wrapperCol:{span:10},label:"操作："},u.a.createElement(r.a,{type:"primary",htmlType:"submit"},"发布"),u.a.createElement(r.a,null,"存为草稿"))))}}]),t}();t.default=Object(p.a)(s.a.create()(O))}}]);