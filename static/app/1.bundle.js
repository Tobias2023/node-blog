(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{179:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(4),l=i(r(255)),n=i(r(5));function i(e){return e&&e.__esModule?e:{default:e}}t.default=(0,a.withRouter)(class extends o.Component{constructor(e,t){super(e,t),this.state={editorContent:"",screenshot:"/static/images/default.jpg",article:{},categories:[]}}componentDidMount(){const{match:e}=this.props,t=this;e.params.id?n.default.all([n.default.get("/articles/"+e.params.id),n.default.get("/categories/")]).then(n.default.spread(function(e,r){t.setState({article:e.data,categories:r.data,editorContent:e.data.content,screenshot:e.data.screenshot})})):n.default.get("/categories/").then(e=>{t.setState({categories:e.data})})}uploadImage(e){const t=this,r=document.createElement("input");r.setAttribute("name","file"),r.setAttribute("type","file"),r.setAttribute("style","visibility:hidden"),r.click(),r.onchange=function(){const e=new FormData;e.append("file",r.files[0]),(0,n.default)({url:"/upload/image?w=200&h=200",method:"post",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>t.setState({screenshot:e.data.url}))}}publish(e){const{match:t,history:r}=this.props,o={},a=e.currentTarget.elements;for(let e=0;e<a.length;e++){let t=a[e];t.name&&(o[t.name]=t.value)}return(t.params.id?this.updateArticle(t.params.id,o):this.createArticle(o)).then(()=>{alert("提交成功"),r.push("/blog/admin/articles")}),e.preventDefault()}createArticle(e){return n.default.post("/articles",e)}updateArticle(e,t){return n.default.put("/articles/"+e,t)}onChange(e){this.setState({editorContent:e})}render(){const e=this.state.article;return(0,o.createVNode)(1,"div","main-content",[(0,o.createVNode)(1,"div","manager-tip",[(0,o.createVNode)(1,"i","fa fa-edit fa-fw"),(0,o.createVNode)(1,"strong",null,(0,o.createTextVNode)("控制台----文章添加或编辑"),2)],4),(0,o.createVNode)(1,"form","form-horizontal",[(0,o.createVNode)(1,"div","alert alert-warning text-center",null,1,{role:"alert"}),(0,o.createVNode)(1,"div","form-group",[(0,o.createVNode)(1,"label","control-label",(0,o.createTextVNode)("文章标题："),2),(0,o.createVNode)(1,"div",null,(0,o.createVNode)(64,"input","form-control input-sm",null,1,{placeholder:"请输入文章标题",type:"text",defaultValue:e.title,name:"title"}),2)],4),(0,o.createVNode)(1,"div","form-group",[(0,o.createVNode)(1,"label","control-label col-sm-3",(0,o.createTextVNode)("文章类别："),2),(0,o.createVNode)(1,"div","col-sm-2",(0,o.createVNode)(256,"select","select-selection",[this.state.categories.map(e=>(0,o.createVNode)(1,"option",null,e.name,0,{value:e._id},e._id)).filter(t=>t.key===(e.category&&e.category._id)),this.state.categories.map(e=>(0,o.createVNode)(1,"option",null,e.name,0,{value:e._id},e._id)).filter(t=>t.key!==(e.category&&e.category._id))],0,{name:"category"}),2)],4),(0,o.createVNode)(1,"div","form-group",[(0,o.createVNode)(1,"label","control-label col-sm-3",(0,o.createTextVNode)("缩略图："),2),(0,o.createVNode)(1,"div",null,[(0,o.createVNode)(1,"div","uploader",(0,o.createVNode)(1,"button","btn is-primary",(0,o.createTextVNode)("上传图片"),2,{type:"button",onClick:e=>this.uploadImage(e)}),2,{id:"uploader"}),(0,o.createVNode)(1,"div","publish-thumbnail",[(0,o.createVNode)(64,"input",null,null,1,{type:"hidden",value:this.state.screenshot,name:"screenshot"}),(0,o.createVNode)(1,"img","img-thumbnail",null,1,{src:this.state.screenshot,width:"121",height:"90",id:"show_img"})],4)],4)],4),(0,o.createVNode)(1,"div","form-group",[(0,o.createVNode)(1,"label","control-label",(0,o.createTextVNode)("内容摘要："),2),(0,o.createVNode)(128,"textarea",null,null,1,{placeholder:"请输入文章内容摘要",name:"summary",value:e.summary,style:{minHeight:"80px",maxHeight:"115px",width:"550px"}})],4),(0,o.createVNode)(1,"div","form-group",[(0,o.createVNode)(1,"label","control-label col-sm-3",(0,o.createTextVNode)("文章详情："),2),(0,o.createComponentVNode)(2,l.default,{name:"content",value:this.state.editorContent,onChange:e=>this.onChange(e)})],4),(0,o.createVNode)(1,"div","form-group",[(0,o.createVNode)(1,"label","control-label col-sm-3",(0,o.createTextVNode)("操作："),2),(0,o.createVNode)(1,"button","btn is-primary",(0,o.createTextVNode)("发布"),2,{type:"submit"}),(0,o.createVNode)(1,"button","btn",(0,o.createTextVNode)("存为草稿"),2,{id:"save_draft"})],4)],4,{onSubmit:e=>this.publish(e)})],4)}})},194:function(e,t,r){},255:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=n(r(254)),l=n(r(5));function n(e){return e&&e.__esModule?e:{default:e}}const i=r(181);r(197),r(194),t.default=class extends o.Component{constructor(e){super(e),this.markdown=new a.default,this.state={MarkdownContent:"",isPreview:!1}}getCodeMirror(){return this.codeMirror}_replaceSelection(e,t){let r=e.getCursor("start"),o=e.getCursor("end");e.replaceSelection(t.before+e.getSelection()+t.after),r.ch+=t.before.length,o.ch+=t.after.length,e.setSelection(r,o),e.focus()}insertLink(){let e=this.getCodeMirror();this._replaceSelection(e,{before:"[",after:"](http://)"})}insertImage(){const e=this,t=document.createElement("input");t.setAttribute("name","file"),t.setAttribute("type","file"),t.setAttribute("style","visibility:hidden"),t.click(),t.onchange=function(){const r=new FormData;r.append("file",t.files[0]),(0,l.default)({url:"/upload/image",method:"post",data:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(t=>{let r=e.getCodeMirror(),o={before:"![",after:"]("+t.data.url+")"};e._replaceSelection(r,o)})}}preview(){const e=this.markdown.render(this._currentCodemirrorValue);this.state.isPreview?this.setState({isPreview:!1}):this.setState({MarkdownContent:e,isPreview:!0})}toggleFullScreen(){let e=this.getCodeMirror().getWrapperElement(),t=document,r=function(){t.cancelFullScreen?t.cancelFullScreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen&&t.webkitCancelFullScreen()};t.fullScreen||t.mozFullScreen||t.webkitFullScreen?r&&r():e.requestFullScreen?e.requestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}codemirrorValueChanged(e,t){let r=e.getValue();this._currentCodemirrorValue=r,this.props.onChange&&this.props.onChange(r)}getOptions(){return Object.assign({mode:"markdown",lineNumbers:!1,indentWithTabs:!0,tabSize:"4",dragDrop:!1,styleActiveLine:!1,lineWrapping:!0},this.props.options||{})}componentWillReceiveProps(e){this.codeMirror&&this._currentCodemirrorValue!==e.value&&this.codeMirror.setValue(e.value)}componentDidMount(){this.codeMirror=i.fromTextArea(document.getElementById("codemirror"),this.getOptions()),this.codeMirror.on("change",(e,t)=>this.codemirrorValueChanged(e,t)),this._currentCodemirrorValue=this.props.value||""}componentWillUnmount(){this.codeMirror&&this.codeMirror.toTextArea()}render(){return(0,o.createVNode)(1,"div","MdEditor",[(0,o.createVNode)(1,"div","MdEditor-toolbar",[(0,o.createVNode)(1,"button","MdEditor-button",(0,o.createVNode)(32,"svg","MdEditor-svg link",(0,o.createVNode)(1,"path",null,null,1,{d:"M6.77 17.23c-.905-.904-.94-2.333-.08-3.193l3.059-3.06-1.192-1.19-3.059 3.058c-1.489 1.489-1.427 3.954.138 5.519s4.03 1.627 5.519.138l3.059-3.059-1.192-1.192-3.059 3.06c-.86.86-2.289.824-3.193-.08zm3.016-8.673l1.192 1.192 3.059-3.06c.86-.86 2.289-.824 3.193.08.905.905.94 2.334.08 3.194l-3.059 3.06 1.192 1.19 3.059-3.058c1.489-1.489 1.427-3.954-.138-5.519s-4.03-1.627-5.519-.138L9.786 8.557zm-1.023 6.68c.33.33.863.343 1.177.029l5.34-5.34c.314-.314.3-.846-.03-1.176-.33-.33-.862-.344-1.176-.03l-5.34 5.34c-.314.314-.3.846.03 1.177z"}),2,{fill:"currentColor",viewBox:"0 0 24 24",width:"24",height:"24"}),2,{type:"button",onClick:()=>this.insertLink(),title:"链接"}),(0,o.createVNode)(1,"button","MdEditor-button image",(0,o.createVNode)(32,"svg","MdEditor-svg",(0,o.createVNode)(1,"path",null,null,1,{d:"M21 17.444C21 18.3 20.1 19 19 19H5c-1.1 0-2-.7-2-1.556V6.556C3 5.7 3.9 5 5 5h14c1.1 0 2 .7 2 1.556v10.888zm-9.437-3.919a.5.5 0 0 1-.862.013l-1.26-2.065a.5.5 0 0 0-.861.012l-2.153 3.767a.5.5 0 0 0 .435.748h10.292a.5.5 0 0 0 .438-.741L14.573 9.78a.5.5 0 0 0-.872-.006l-2.138 3.75z"}),2,{fill:"currentColor",viewBox:"0 0 24 24",width:"24",height:"24"}),2,{type:"button",onClick:()=>this.insertImage(),title:"上传图片"}),(0,o.createVNode)(1,"button","MdEditor-button eye",(0,o.createVNode)(32,"svg","MdEditor-svg",(0,o.createVNode)(1,"path",null,null,1,{d:"M569.354 231.631C512.969 135.949 407.81 72 288 72 168.14 72 63.004 135.994 6.646 231.631a47.999 47.999 0 0 0 0 48.739C63.031 376.051 168.19 440 288 440c119.86 0 224.996-63.994 281.354-159.631a47.997 47.997 0 0 0 0-48.738zM288 392c-75.162 0-136-60.827-136-136 0-75.162 60.826-136 136-136 75.162 0 136 60.826 136 136 0 75.162-60.826 136-136 136zm104-136c0 57.438-46.562 104-104 104s-104-46.562-104-104c0-17.708 4.431-34.379 12.236-48.973l-.001.032c0 23.651 19.173 42.823 42.824 42.823s42.824-19.173 42.824-42.823c0-23.651-19.173-42.824-42.824-42.824l-.032.001C253.621 156.431 270.292 152 288 152c57.438 0 104 46.562 104 104z"}),2,{viewBox:"0 0 512 512",width:"30",height:"20"}),2,{type:"button",onClick:()=>this.preview(),title:"预览"}),(0,o.createVNode)(1,"div",null,(0,o.createVNode)(1,"strong",null,(0,o.createTextVNode)("markdown编辑器，开始写作吧！"),2),2,{style:"flex: 1 0 auto;text-align:center"}),(0,o.createVNode)(1,"button","MdEditor-button help",(0,o.createVNode)(32,"svg","MdEditor-svg",(0,o.createVNode)(1,"path",null,null,1,{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}),2,{viewBox:"0 0 512 512",width:"20",height:"20"}),2,{type:"button",title:"帮助"}),(0,o.createVNode)(1,"button","MdEditor-button fullscreen",(0,o.createVNode)(32,"svg","MdEditor-svg",(0,o.createVNode)(1,"path",null,null,1,{d:"M352.201 425.775l-79.196 79.196c-9.373 9.373-24.568 9.373-33.941 0l-79.196-79.196c-15.119-15.119-4.411-40.971 16.971-40.97h51.162L228 284H127.196v51.162c0 21.382-25.851 32.09-40.971 16.971L7.029 272.937c-9.373-9.373-9.373-24.569 0-33.941L86.225 159.8c15.119-15.119 40.971-4.411 40.971 16.971V228H228V127.196h-51.23c-21.382 0-32.09-25.851-16.971-40.971l79.196-79.196c9.373-9.373 24.568-9.373 33.941 0l79.196 79.196c15.119 15.119 4.411 40.971-16.971 40.971h-51.162V228h100.804v-51.162c0-21.382 25.851-32.09 40.97-16.971l79.196 79.196c9.373 9.373 9.373 24.569 0 33.941L425.773 352.2c-15.119 15.119-40.971 4.411-40.97-16.971V284H284v100.804h51.23c21.382 0 32.09 25.851 16.971 40.971z"}),2,{viewBox:"0 0 512 512",width:"20",height:"20"}),2,{type:"button",onClick:()=>this.toggleFullScreen(),title:"全屏"})],0),(0,o.createVNode)(1,"div","MdEditor-wraper",[(0,o.createVNode)(128,"textarea",null,null,1,{id:"codemirror",name:this.props.name,defaultValue:this.props.value}),this.state.isPreview&&(0,o.createVNode)(1,"div","preview markdown-body",null,1,{dangerouslySetInnerHTML:{__html:this.state.MarkdownContent}})],0)],4)}}}}]);